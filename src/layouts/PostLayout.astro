---
import BaseLayout from "./BaseLayout.astro";
import TableOfContents from "../components/TableOfContents.astro";
import Comments from "../components/Comments.astro";
import { formatDate, getCategoryLabel } from "../utils/posts";

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  category: string;
  tags: string[];
  heroImage?: string;
  headings: { depth: number; slug: string; text: string }[];
}

const {
  title,
  description,
  pubDate,
  updatedDate,
  category,
  tags,
  heroImage,
  headings,
} = Astro.props;
---

<BaseLayout
  title={`${title} | Engineering Blog`}
  description={description}
  image={heroImage}
  type="article"
  publishedTime={pubDate}
>
  <article class="max-w-6xl mx-auto px-4 py-12">
    <!-- Header -->
    <header class="mb-8">
      <div class="flex items-center gap-3 text-sm mb-4">
        <a
          href={`/blog/${category}/`}
          class="px-3 py-1 rounded-md bg-[var(--bg-tertiary)] text-[var(--text-secondary)] font-medium hover:bg-[var(--color-primary)] hover:text-white transition-colors"
        >
          {getCategoryLabel(category)}
        </a>
        <time datetime={pubDate.toISOString()} class="text-[var(--text-muted)]">
          {formatDate(pubDate)}
        </time>
        {
          updatedDate && (
            <span class="text-[var(--text-muted)]">
              (Updated: {formatDate(updatedDate)})
            </span>
          )
        }
      </div>

      <h1
        class="text-3xl md:text-4xl font-bold text-[var(--text-primary)] mb-4"
      >
        {title}
      </h1>

      <p class="text-lg text-[var(--text-secondary)]">
        {description}
      </p>

      {
        tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-4">
            {tags.map((tag) => (
              <span class="text-sm px-3 py-1 rounded-full bg-[var(--bg-secondary)] text-[var(--text-muted)]">
                #{tag}
              </span>
            ))}
          </div>
        )
      }
    </header>

    <!-- Hero Image -->
    {
      heroImage && (
        <div class="aspect-video rounded-xl overflow-hidden mb-8 bg-[var(--bg-tertiary)]">
          <img src={heroImage} alt="" class="w-full h-full object-cover" />
        </div>
      )
    }

    <!-- Table of Contents -->
    {
      headings.length > 0 && (
        <div class="mb-8">
          <TableOfContents headings={headings} />
        </div>
      )
    }

    <!-- Content -->
    <div class="prose" data-pagefind-body>
      <slot />
    </div>

    <!-- Comments -->
    <Comments />
  </article>

  <script
    src="https://giscus.app/client.js"
    data-repo="endiesworld/endiesworld.github.io"
    data-repo-id="R_kgDOQ7BTgQ"
    data-category="General"
    data-category-id="DIC_kwDOQ7BTgc4C1hst"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="en"
    crossorigin="anonymous"
    async
  ></script>
</BaseLayout>
